## Merge R1 and R2 files using default parameters
#./usearch -fastq_mergepairs 16S-mockS.1_V4_R1-hdr.fastq -reverse 16S-mockS.1_V4_R2-hdr.fastq -fastqout 16S-mock-merged.fq

## Get stats on reads merged using default parameters
#./usearch -fastx_info 16S-mock-merged.fq

## Merge R1 and R2 files using different parameters to account for the long overlap typical of 2x250 V4. For example, it is often better to allow more differences in the alignment compared to the default parameters.
##For example, you might choose to increase set -fastq_maxdiffs 10 -fastq_pctid 80:

#./usearch -fastq_mergepairs 16S-mockS.1_V4_R1-hdr.fastq -reverse 16S-mockS.1_V4_R2-hdr.fastq -relabel @ -fastq_maxdiffs 10 -fastq_pctid 80 -fastqout 16S-mock-merged_maxdif10.fq

# for our project we were presumably given a merged fastq file.
# we will start the pipeline here

## Get stats on reads merged using different parameters
./usearch -fastx_info project1.fastq

## Determine parameters for length cutoffs and max ee value
##COMMAND fastq_eestats2 using non-default parameters for merged reads ***the -length_cutoffs and -ee_cutoffs parameters need to be given after the -output file flag.
./usearch -fastq_eestats2 project1.fastq -output project1.fastq.stats2 -length_cutoffs 150,250,50 -ee_cutoffs 0.5,1.0,2.0

## Perform Quality control
##COMMAND QC merged reads using parameters chosen (400 or 300 bp length and max_ee 1)
./usearch -fastq_filter project1.fastq -fastq_trunclen 400 -fastq_maxee 1 -fastqout project1-ee.1truc400.fq

./usearch -fastq_filter project1.fastq -fastq_trunclen 300 -fastq_maxee 1 -fastqout project1-ee.1truc300.fq

## Remove unique clusters
##Dereplicate sequences to find unique reads (removes unique clusters with <3 reads)
./usearch -fastx_uniques project1-ee.1truc400.fq -fastaout project1-ee.1truc400.uniques.fa -minuniquesize 2 -sizeout -relabel Uniq

./usearch -fastx_uniques project1-ee.1truc300.fq -fastaout project1-ee.1truc300.uniques.fa -minuniquesize 2 -sizeout -relabel Uniq

## Find unique OTUs.
## cluster de-replicated sequences at 97% sequence identity
./usearch -cluster_otus project1-ee.1truc400.uniques.fa -otus project1-ee.1truc400.uniques-rad3.fa -relabel OTU_  -uparseout project1-ee.1truc400.uniques-rad3.txt

./usearch -cluster_otus project1-ee.1truc300.uniques.fa -otus project1-ee.1truc300.uniques-rad3.fa -relabel OTU_  -uparseout project1-ee.1truc300.uniques-rad3.txt

######################################################################################################
## Rerun again for question 7 with new values: 300 length and 0.5 max_ee

## Perform Quality control
##COMMAND QC merged reads using parameters chosen (400 or 300 bp length and max_ee 1)
./usearch -fastq_filter project1.fastq -fastq_trunclen 300 -fastq_maxee 0.5 -fastqout project1-ee.0.5truc300.fq

## Remove unique clusters
##Dereplicate sequences to find unique reads (removes unique clusters with <3 reads)
./usearch -fastx_uniques project1-ee.0.5truc300.fq -fastaout project1-ee.0.5truc300.uniques.fa -minuniquesize 2 -sizeout -relabel Uniq

## Find unique OTUs.
## cluster de-replicated sequences at 97% sequence identity
./usearch -cluster_otus project1-ee.0.5truc300.uniques.fa -otus project1-ee.0.5truc300.uniques-rad3.fa -relabel OTU_  -uparseout project1-ee.0.5truc300.uniques-rad3.txt
